/*!
    Akashic.js -- Quicksave for Websites
    Version 0.1.1
    https://github.com/NaeemBolchhi/akashic-js
    (c) 2025 NaeemBolchhi, MIT License
*/
(function(){"use strict";async function t(){let t=document.querySelector('script[src*="akashic.min.js"],script[src*="akashic.js"]');if(window.akashicAssets={html:[],css:[],js:[]},null!==t.getAttribute("data-akashic")&&""!==t.getAttribute("data-akashic")){let e=t.getAttribute("data-akashic");try{window.akashicAssets=JSON.parse(e)}catch{try{window.akashicAssets=JSON.parse(u.decompress(e))}catch{try{window.akashicAssets=JSON.parse(w.undo(e))}catch{try{window.akashicAssets=JSON.parse(u.decompress(w.undo(e)))}catch{console.log("Akashic.js: Could not parse data-akashic string.")}}}}}let e=document.querySelectorAll('akashic-css,akashic-html,akashic-js,link[rel="akashic"]');for(let t=0;t<e.length;t++){let a=e[t].tagName.toLowerCase().replace(/^.*\-/i,""),n=e[t].getAttribute("data-name"),r=e[t].getAttribute("data-path"),o=e[t].getAttribute("data-version"),s=e[t].closest("head,body").tagName.toLowerCase(),i=e[t].getAttribute("data-id")||"",c=e[t].getAttribute("data-store")||"ls";"link"===a&&(a=e[t].getAttribute("data-tag")),window.akashicAssets[a].push({fn:n,pt:r,vr:o,pr:s,id:i,st:c})}}async function e(){let t=document.querySelectorAll('script[data-frag="true"],akashic-css,akashic-html,akashic-js,link[rel="akashic"]');for(let e=0;e<t.length;e++)t[e].remove();delete window.akashicAssets,delete window.inDBCache,delete window.akashicStatus,delete window.akashicLoad,delete window.akashicSave}async function a(){if(!window.akashicAssets.hasOwnProperty("css"))return;let t=window.akashicAssets.css,e="CSS_";for(let a=0;a<t.length;a++)if(null===localStorage.getItem(e+t[a].fn)||parseInt(localStorage.getItem(e+t[a].fn))<t[a].vr){let n=t[a].pt+t[a].fn,r=document.createElement("link");t[a].pt.match(/^http/i)||(n=window.location.origin+n),r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.href=n,""!==t[a].id&&void 0!==t[a].id&&(r.id=t[a].id),document.head.appendChild(r),window.akashicSave.push({0:[n,t[a].fn,e,t[a].st],1:[t[a].fn,t[a].vr]})}else window.akashicLoad.push({0:[t[a].fn,e],1:[t[a].st]})}async function n(){if(!window.akashicAssets.hasOwnProperty("html"))return;let t=window.akashicAssets.html,e="HTML_";for(let a=0;a<t.length;a++)if(null===localStorage.getItem(e+t[a].fn)||parseInt(localStorage.getItem(e+t[a].fn))<t[a].vr){let n=t[a].pt+t[a].fn,r=document.createElement("script");t[a].pt.match(/^http/i)||(n=window.location.origin+n),r.setAttribute("type","text/javascript"),r.setAttribute("data-frag","true"),r.src=n,document.body.appendChild(r),window.akashicSave.push({0:[n,t[a].fn,e,t[a].st],1:[t[a].fn,t[a].vr]})}else window.akashicLoad.push({0:[t[a].fn,e],1:[t[a].st]})}async function r(){if(!window.akashicAssets.hasOwnProperty("js"))return;let t=window.akashicAssets.js,e="JS_";for(let a=0;a<t.length;a++)if(null===localStorage.getItem(e+t[a].fn)||parseInt(localStorage.getItem(e+t[a].fn))<t[a].vr){let n=t[a].pt+t[a].fn,r=document.createElement("script");n=t[a].pt.match(/^http/i)?t[a].pt+t[a].fn:window.location.origin+n,r.setAttribute("type","text/javascript"),r.src=n,""!==t[a].id&&void 0!==t[a].id&&(r.id=t[a].id),document.querySelector(t[a].pr).appendChild(r),window.akashicSave.push({0:[n,t[a].fn,e,t[a].st],1:[t[a].fn,t[a].vr]})}else window.akashicLoad.push({0:[t[a].fn,e],1:[t[a].st]})}async function o(){try{let t=window.akashicSave;for(let e=0;e<t.length;e++){let a=m.quicksave;"indb"===t[e][0][3]&&(a=m.save),!0===await a(t[e][0][0],t[e][0][1],t[e][0][2])&&localStorage.setItem(t[e][0][2]+t[e][1][0],t[e][1][1])}await f.toCache()}catch(t){return console.error("Akashic.js Error: Something went wrong:",t),null}}async function s(t){function e(t){a[t][0][1].match(/css/i)?i(a[t][0][0],a[t][0][1]):a[t][0][1].match(/html/i)?c(a[t][0][0],a[t][0][1]):a[t][0][1].match(/js/i)&&d(a[t][0][0],a[t][0][1])}let a=window.akashicLoad;for(let n=0;n<a.length;n++)"indb"===a[n][1][0]||t?"indb"===a[n][1][0]&&t&&e(n):e(n)}async function i(t,e){let a=window.akashicAssets.css;for(let n=0;n<a.length;n++)if(a[n].fn===t){if(document.querySelector(`style[data-file="${a[n].fn}"]`))continue;let r=document.createElement("style"),o=m.quickload;r.setAttribute("type","text/css"),"indb"===a[n].st&&(o=m.load),r.textContent=await o(e+t+"_data"),""!==a[n].id&&void 0!==a[n].id&&(r.id=a[n].id),r.setAttribute("data-file",a[n].fn),document.head.appendChild(r);break}}async function c(t,e){let a=window.akashicAssets.html;for(let n=0;n<a.length;n++)if(a[n].fn===t){if(document.querySelector(`script[data-file="${a[n].fn}"]`))continue;let r=document.createElement("script"),o=m.quickload;r.setAttribute("type","text/javascript"),"indb"===a[n].st&&(o=m.load),r.textContent=await o(e+t+"_data"),r.setAttribute("data-file",a[n].fn),r.setAttribute("data-frag","true"),document.body.appendChild(r);break}}async function d(t,e){let a=window.akashicAssets.js;for(let n=0;n<a.length;n++)if(a[n].fn===t){if(document.querySelector(`script[data-file="${a[n].fn}"]`))continue;let r=document.createElement("script"),o=m.quickload;r.setAttribute("type","text/javascript"),"indb"===a[n].st&&(o=m.load),r.textContent=await o(e+t+"_data"),""!==a[n].id&&void 0!==a[n].id&&(r.id=a[n].id),r.setAttribute("data-file",a[n].fn),document.querySelector(a[n].pr).appendChild(r);break}}async function l(){await t(),document.documentElement.style.display="none",await a(),await n(),await r(),await s(),document.documentElement.style.removeProperty("display"),""===document.documentElement.getAttribute("style")&&document.documentElement.removeAttribute("style"),await f.toWindow(),await s(!0),await o(),await e()}const u={compress:function(t){var e,a,n,r={},o="",s=[],i=256;for(e=0;e<256;e+=1)r[String.fromCharCode(e)]=e;for(e=0;e<t.length;e+=1)a=t.charAt(e),n=o+a,r.hasOwnProperty(n)?o=n:(s.push(r[o]),r[n]=i++,o=String(a));return""!==o&&s.push(r[o]),s.toString()},decompress:function(t){let e=t.split(",").map(Number);var a,n,r,o,s=[],i="",c=256;for(a=0;a<256;a+=1)s[a]=String.fromCharCode(a);for(n=String.fromCharCode(e[0]),r=n,a=1;a<e.length;a+=1){if(o=e[a],s[o])i=s[o];else{if(o!==c)return null;i=n+n.charAt(0)}r+=i,s[c++]=n+i.charAt(0),n=i}return r}},h={dbName:"AkashicDB",storeName:"AkashicAssets",dbVersion:1,open:async function(){return new Promise(((t,e)=>{const a=indexedDB.open(h.dbName,h.dbVersion);a.onupgradeneeded=t=>{const e=t.target.result;e.objectStoreNames.contains(h.storeName)||e.createObjectStore(h.storeName)},a.onsuccess=e=>{t(e.target.result)},a.onerror=t=>{e(t.target.error)}}))},write:async function(t,e){let a;try{a=await h.open();const n=a.transaction([h.storeName],"readwrite"),r=n.objectStore(h.storeName);return new Promise(((o,s)=>{const i=r.put(e,t);i.onsuccess=()=>{o()},i.onerror=t=>{s(t.target.error)},n.oncomplete=()=>{a.close()},n.onerror=t=>{s(t.target.error)}}))}catch(t){throw a&&a.close(),t}},read:async function(t){let e;try{e=await h.open();const a=e.transaction([h.storeName],"readonly"),n=a.objectStore(h.storeName);return new Promise(((r,o)=>{const s=n.get(t);s.onsuccess=t=>{r(t.target.result||null)},s.onerror=t=>{o(t.target.error)},a.oncomplete=()=>{e.close()},a.onerror=t=>{o(t.target.error)}}))}catch(t){throw e&&e.close(),t}}},w={do:function(t){return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode("0x"+e)})))},undo:function(t){return decodeURIComponent(atob(t).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""))}},f={dbkey:"aCache",toWindow:async function(){window.inDBCache=await h.read(f.dbkey)},toCache:async function(){const t=Object.assign({},await h.read(f.dbkey),window.inDBCache);await h.write(f.dbkey,t)}},m={fetch:async function(t,e){try{const e=await fetch(t+"?"+Date.now());if(!e.ok)throw new Error(`HTTP error! Status: ${e.status} for ${t}`);const a=await e.text();return u.compress(a)}catch(a){console.error(`Akashic.js Error: Failed to fetch '${e}' from ${t}:`,a)}},quicksave:async function(t,e,a){try{let n=await m.fetch(t,e);if(null!=n)return localStorage.setItem(a+e+"_data",n),!0}catch(t){console.error(`Akashic.js Error: Failed to cache '${e}':`,t)}},save:async function(t,e,a){try{let n=await m.fetch(t,e);if(null!=n)return window.inDBCache[a+e+"_data"]=n,!0}catch(t){console.error(`Akashic.js Error: Failed to cache '${e}':`,t)}},quickload:async function(t){try{let e=localStorage.getItem(t);return null!=e?u.decompress(e):null}catch(e){return console.error(`Akashic.js Error: Failed to retrieve '${t}' from cache:`,e),null}},load:async function(t){try{let e=window.inDBCache[t];return null!=e?u.decompress(e):null}catch(e){return console.error(`Akashic.js Error: Failed to retrieve '${t}' from cache:`,e),null}}};window.inDBCache={},window.akashicSave=[],window.akashicLoad=[],"complete"==document.readyState||"interactive"==document.readyState?l():document.addEventListener("readystatechange",(()=>{!0!==window.akashicStatus&&("complete"!==document.readyState&&"interactive"!==document.readyState||(l(),window.akashicStatus=!0))}))})();